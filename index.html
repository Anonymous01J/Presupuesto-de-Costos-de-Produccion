<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ’° Costos de producciÃ³n Â· GenÃ©rico Â· Responsive</title>

  <!-- CSS de terceros (locales) -->
  <link rel="stylesheet" href="assets/libs/bootstrap/bootstrap.min.css">
  <!-- Bootstrap Icons: apunta al CSS dentro de la carpeta descomprimida para que encuentre fonts/ al mismo nivel -->
  <link rel="stylesheet" href="assets/libs/bootstrap/bootstrap-icons-1.13.1/bootstrap-icons.min.css">
  <link rel="stylesheet" href="assets/libs/dataTable/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="assets/libs/dataTable/responsive.bootstrap5.min.css">
  <link rel="stylesheet" href="assets/libs/select2/select2.min.css">
  <link rel="stylesheet" href="assets/libs/select2/select2-bootstrap-5-theme.min.css">
  <link rel="stylesheet" href="assets/libs/introjs/introjs.min.css">

  <!-- CSS propio -->
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<!-- BotÃ³n flotante de ayuda -->
<button class="btn-floating-help" id="btnAyudaPrincipal" title="Ayuda principal">
  <i class="bi bi-question-lg"></i>
</button>

<!-- Navbar -->
<nav class="navbar navbar-light bg-white border-bottom shadow-sm anim-fade-down">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1"><i class="bi bi-calculator me-2"></i>Costos de producciÃ³n Â· GenÃ©rico</span>
    <div class="d-flex">
      <span class="badge bg-primary p-2">versiÃ³n dinÃ¡mica + responsive</span>
    </div>
  </div>
</nav>

<main class="container my-4">

  <!-- Encabezado + botÃ³n nuevo presupuesto -->
  <div class="d-grid gap-2 d-sm-flex justify-content-sm-between align-items-center mb-4 anim-fade-right">
    <h2><i class="bi bi-pencil-square me-2"></i>Presupuesto de producto</h2>
    <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#costeoModal">
      <i class="bi bi-plus-circle me-2"></i>Nuevo presupuesto
    </button>
  </div>

  <!-- Resumen ejecutivo (con colores de leyenda) -->
  <div class="card shadow-sm border-0 mb-5 anim-fade-up">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0"><i class="bi bi-file-spreadsheet me-2"></i>Resumen Ejecutivo Â· Ãºltimo presupuesto</h5>
    </div>
    <div class="card-body">
      <table class="table table-bordered table-hover align-middle" id="resumen-ejecutivo-table" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Indicador</th>
            <th>12 <span id="resumenUnidadLabel">unidades</span></th>
            <th>10 <span id="resumenUnidadLabel2">unidades</span></th>
            <th>6 <span id="resumenUnidadLabel3">unidades</span></th>
            <th>Por unidad (Bs.)</th>
            <th>Por unidad ($)</th>
          </tr>
        </thead>
        <tbody>
          <tr class="bg-verde">
            <td>Costo Total de ProducciÃ³n</td>
            <td id="resCosto12">0,00</td><td id="resCosto10">0,00</td><td id="resCosto6">0,00</td>
            <td id="resCostoUnitBs">0,00</td><td id="resCostoUnitUsd">0,00</td>
          </tr>
          <tr>
            <td>Utilidad (%)</td>
            <td id="resUtil12">0,00</td><td id="resUtil10">0,00</td><td id="resUtil6">0,00</td>
            <td id="resUtilUnitBs">0,00</td><td id="resUtilUnitUsd">0,00</td>
          </tr>
          <tr class="bg-rojo">
            <td>Precio de Venta Total</td>
            <td id="resPVta12">0,00</td><td id="resPVta10">0,00</td><td id="resPVta6">0,00</td>
            <td id="resPVtaUnitBs">0,00</td><td id="resPVtaUnitUsd">0,00</td>
          </tr>
          <tr>
            <td>IVA (%)</td>
            <td id="resIva12">0,00</td><td id="resIva10">0,00</td><td id="resIva6">0,00</td>
            <td id="resIvaUnitBs">0,00</td><td id="resIvaUnitUsd">0,00</td>
          </tr>
          <tr class="bg-amarillo">
            <td>PRECIO FINAL AL CLIENTE</td>
            <td id="resFinal12">0,00</td><td id="resFinal10">0,00</td><td id="resFinal6">0,00</td>
            <td id="resFinalUnitBs">0,00</td><td id="resFinalUnitUsd">0,00</td>
          </tr>
        </tbody>
      </table>
      <div class="mt-2 d-flex gap-3 small">
        <span><span class="leyenda-box bg-verde"></span> Costo total</span>
        <span><span class="leyenda-box bg-rojo"></span> Precio de venta</span>
        <span><span class="leyenda-box bg-amarillo"></span> Precio final al cliente</span>
      </div>
    </div>
  </div>

  <!-- MODAL FULLSCREEN PROGRESIVO (wizard 5 pasos) -->
  <div class="modal fade" id="costeoModal" tabindex="-1" aria-labelledby="modalTitle" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-fullscreen">
      <div class="modal-content">

        <div class="modal-header bg-light">
          <h5 class="modal-title" id="modalTitle"><i class="bi bi-layers me-2"></i>Crear presupuesto genÃ©rico</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">

          <!-- Indicador de pasos -->
          <div class="step-indicator mb-4" id="stepIndicator">
            <div class="step-item" data-step="1"><div class="step-circle">1</div><div class="step-label">Datos generales</div></div>
            <div class="step-item" data-step="2"><div class="step-circle">2</div><div class="step-label">Materia prima</div></div>
            <div class="step-item" data-step="3"><div class="step-circle">3</div><div class="step-label">Mano de obra</div></div>
            <div class="step-item" data-step="4"><div class="step-circle">4</div><div class="step-label">CIF</div></div>
            <div class="step-item" data-step="5"><div class="step-circle">5</div><div class="step-label">Resumen</div></div>
          </div>

          <!-- PASO 1: Datos generales -->
          <div class="step active" id="step1">
            <div class="card border-0 shadow-sm anim-fade-in">
              <div class="card-header bg-azul bg-opacity-25 d-flex justify-content-between align-items-center">
                <h6 class="mb-0"><i class="bi bi-sliders2 me-2"></i>Datos del producto y supuestos</h6>
                <button class="btn btn-sm btn-outline-secondary btn-help" data-step="1" title="Ayuda para este paso">
                  <i class="bi bi-question-circle"></i> Ayuda
                </button>
              </div>
              <div class="card-body">
                <div class="row g-4">
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Nombre del producto</label>
                    <input type="text" class="form-control input-modificable" id="productoNombre" value="Producto genÃ©rico">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Unidad de venta</label>
                    <select class="form-select select2-unidad" id="unidadVenta" style="width:100%;">
                      <option value="unidad" selected>unidad</option>
                      <option value="kg">kg</option>
                      <option value="litro">litro</option>
                      <option value="caja">caja</option>
                      <option value="par">par</option>
                      <option value="docena">docena</option>
                    </select>
                    <div class="form-text">Puede escribir cualquier unidad personalizada.</div>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label fw-semibold">Tasa de cambio (Bs./$)</label>
                    <div class="input-group">
                      <input type="text" class="form-control input-modificable" id="tasaCambio" value="402.33">
                      <button class="btn btn-outline-secondary" type="button" id="btnActualizarApi" title="Actualizar desde API">
                        <i class="bi bi-arrow-repeat"></i>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label fw-semibold">% Utilidad (decimal)</label>
                    <input type="number" class="form-control input-modificable" id="porcUtilidad" value="0.35" step="0.01" min="0" max="1">
                  </div>
                  <div class="col-md-3">
                    <label class="form-label fw-semibold">Cantidad base del lote</label>
                    <input type="number" class="form-control input-modificable" id="loteBase" value="2" min="1">
                  </div>
                  <div class="col-md-3">
                    <label class="form-label fw-semibold">% IVA (decimal)</label>
                    <input type="number" class="form-control input-modificable" id="porcIva" value="0.16" step="0.01" min="0">
                  </div>
                </div>
                <div class="mt-3 text-muted small"><i class="bi bi-info-circle"></i> Los valores en azul son editables.</div>
              </div>
            </div>
          </div>

          <!-- PASO 2: Materia prima -->
          <div class="step" id="step2">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-azul bg-opacity-25 d-flex justify-content-between align-items-center">
                <h6 class="mb-0"><i class="bi bi-basket me-2"></i>Materia prima</h6>
                <div>
                  <button class="btn btn-sm btn-outline-secondary btn-help me-2" data-step="2" title="Ayuda para este paso">
                    <i class="bi bi-question-circle"></i> Ayuda
                  </button>
                  <button class="btn btn-sm btn-outline-primary btn-add-row" id="addRowMP"><i class="bi bi-plus-lg"></i> Agregar insumo</button>
                </div>
              </div>
              <div class="card-body p-0">
                <table class="table table-bordered mb-0 align-middle w-100" id="tablaMP" style="width:100%">
                  <thead class="table-secondary">
                    <tr>
                      <th>Insumo</th>
                      <th>Cantidad</th>
                      <th>Unidad</th>
                      <th>Costo USD</th>
                      <th>Costo Bs.</th>
                      <th>Subtotal ($)</th>
                      <th>Subtotal (Bs.)</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><input type="text" class="form-control form-control-sm" value="Material A"></td>
                      <td><input type="number" class="form-control form-control-sm input-modificable cantidad" value="2" step="0.01"></td>
                      <td>
                        <select class="form-select form-select-sm select2-unidad-tabla" style="width:100px;">
                          <option value="kg">kg</option><option value="g">g</option>
                          <option value="L">L</option><option value="ml">ml</option><option value="unidad">unidad</option>
                        </select>
                      </td>
                      <td><input type="text" class="form-control form-control-sm input-modificable input-price costo-usd" value="5,00"></td>
                      <td><span class="costo-bs readonly-value">0,00</span></td>
                      <td><span class="subtotal-usd readonly-value">0,00</span></td>
                      <td><span class="subtotal-bs readonly-value">0,00</span></td>
                      <td><button class="btn btn-sm btn-outline-danger remove-row"><i class="bi bi-trash"></i></button></td>
                    </tr>
                  </tbody>
                  <tfoot>
                    <tr class="total-row">
                      <th colspan="5" class="text-end">Subtotal Materia Prima</th>
                      <th id="totalMPUsd">0,00 $</th>
                      <th id="totalMPBs">0,00 Bs.</th>
                      <th></th>
                    </tr>
                  </tfoot>
                </table>
                <div class="mt-3 text-muted small"><i class="bi bi-info-circle"></i> Los valores en azul son editables.</div>
              </div>
            </div>
          </div>

          <!-- PASO 3: Mano de obra directa -->
          <div class="step" id="step3">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-azul bg-opacity-25 d-flex justify-content-between align-items-center">
                <h6 class="mb-0"><i class="bi bi-person-workspace me-2"></i>Mano de obra directa</h6>
                <div>
                  <button class="btn btn-sm btn-outline-secondary btn-help me-2" data-step="3" title="Ayuda para este paso">
                    <i class="bi bi-question-circle"></i> Ayuda
                  </button>
                  <button class="btn btn-sm btn-outline-primary btn-add-row" id="addRowMOD"><i class="bi bi-plus-lg"></i> Agregar cargo</button>
                </div>
              </div>
              <div class="card-body p-0">
                <table class="table table-bordered mb-0 align-middle w-100" id="tablaMOD" style="width:100%">
                  <thead class="table-secondary">
                    <tr>
                      <th>Cargo</th>
                      <th id="thPago" class="th-select2">
                        <select class="form-select form-select-sm" id="selectUnidadTiempo" style="width:100%;">
                          <option value="hora">Pago/hora (USD)</option>
                          <option value="dia">Pago/dÃ­a (USD)</option>
                          <option value="semana">Pago/semana (USD)</option>
                          <option value="mes">Pago/mes (USD)</option>
                        </select>
                      </th>
                      <th>Pago Bs.</th>
                      <th id="thCantidad">Horas</th>
                      <th>Subtotal (Bs.)</th>
                      <th>Subtotal ($)</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><input type="text" class="form-control form-control-sm" value="Operario"></td>
                      <td><input type="text" class="form-control form-control-sm input-modificable input-price pago-usd" value="7,00"></td>
                      <td><span class="pago-bs readonly-value">0,00</span></td>
                      <td><input type="number" class="form-control form-control-sm input-modificable cantidad-tiempo" value="1" step="0.1"></td>
                      <td><span class="subtotal-bs readonly-value">0,00</span></td>
                      <td><span class="subtotal-usd readonly-value">0,00</span></td>
                      <td><button class="btn btn-sm btn-outline-danger remove-row"><i class="bi bi-trash"></i></button></td>
                    </tr>
                  </tbody>
                  <tfoot>
                    <tr class="total-row">
                      <th colspan="4" class="text-end">Subtotal Mano de Obra</th>
                      <th id="totalMODBs">0,00 Bs.</th>
                      <th id="totalMODUsd">0,00 $</th>
                      <th></th>
                    </tr>
                  </tfoot>
                </table>
                <div class="mt-3 text-muted small"><i class="bi bi-info-circle"></i> Los valores en azul son editables.</div>
              </div>
            </div>
          </div>

          <!-- PASO 4: CIF -->
          <div class="step" id="step4">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-azul bg-opacity-25 d-flex justify-content-between align-items-center">
                <h6 class="mb-0"><i class="bi bi-tools me-2"></i>Costos indirectos de fabricaciÃ³n</h6>
                <div>
                  <button class="btn btn-sm btn-outline-secondary btn-help me-2" data-step="4" title="Ayuda para este paso">
                    <i class="bi bi-question-circle"></i> Ayuda
                  </button>
                  <button class="btn btn-sm btn-outline-primary btn-add-row" id="addRowCIF"><i class="bi bi-plus-lg"></i> Agregar concepto</button>
                </div>
              </div>
              <div class="card-body p-0">
                <table class="table table-bordered mb-0 align-middle w-100" id="tablaCIF" style="width:100%">
                  <thead class="table-secondary">
                    <tr>
                      <th>DescripciÃ³n</th>
                      <th>Base de cÃ¡lculo</th>
                      <th>Costo USD</th>
                      <th>Costo Bs.</th>
                      <th>Total ($)</th>
                      <th>Total (Bs.)</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><input type="text" class="form-control form-control-sm" value="EnergÃ­a"></td>
                      <td><input type="text" class="form-control form-control-sm" value="consumo estimado"></td>
                      <td><input type="text" class="form-control form-control-sm input-modificable input-price costo-usd" value="2,50"></td>
                      <td><span class="costo-bs readonly-value">0,00</span></td>
                      <td><span class="total-usd readonly-value">0,00</span></td>
                      <td><span class="total-bs readonly-value">0,00</span></td>
                      <td><button class="btn btn-sm btn-outline-danger remove-row"><i class="bi bi-trash"></i></button></td>
                    </tr>
                  </tbody>
                  <tfoot>
                    <tr class="total-row">
                      <th colspan="4" class="text-end">Subtotal CIF</th>
                      <th id="totalCIFUsd">0,00 $</th>
                      <th id="totalCIFBs">0,00 Bs.</th>
                      <th></th>
                    </tr>
                  </tfoot>
                </table>
                <div class="mt-3 text-muted small"><i class="bi bi-info-circle"></i> Los valores en azul son editables.</div>
              </div>
            </div>
          </div>

          <!-- PASO 5: Resumen -->
          <div class="step" id="step5">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-verde bg-opacity-25 d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                  <i class="bi bi-table me-2"></i>Resumen para
                  <span id="resumenLoteBase">2</span> <span id="resumenUnidadLote">unidades</span>
                </h6>
                <button class="btn btn-sm btn-outline-secondary btn-help" data-step="5" title="Ayuda para este paso">
                  <i class="bi bi-question-circle"></i> Ayuda
                </button>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-lg-6">
                    <div class="card border-0 shadow-sm h-100">
                      <div class="card-body" id="resumenFinal"></div>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="card border-0 shadow-sm mb-3">
                      <div class="card-header bg-white">
                        <h6 class="mb-0">
                          <i class="bi bi-bar-chart me-2"></i>Comparativo: 12, 10 y 6
                          <span id="compUnidad">unidades</span> (Bs. / $)
                        </h6>
                      </div>
                      <div class="card-body p-0">
                        <table class="table table-bordered mb-0" id="tablaComparativa">
                          <thead>
                            <tr>
                              <th>Concepto</th>
                              <th>12 uds (Bs./$)</th>
                              <th>10 uds (Bs./$)</th>
                              <th>6 uds (Bs./$)</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr><td>Costo ProducciÃ³n</td><td id="compCosto12">0,00 / 0,00</td><td id="compCosto10">0,00 / 0,00</td><td id="compCosto6">0,00 / 0,00</td></tr>
                            <tr><td>Utilidad</td>         <td id="compUtil12">0,00 / 0,00</td><td id="compUtil10">0,00 / 0,00</td><td id="compUtil6">0,00 / 0,00</td></tr>
                            <tr><td>Precio Venta</td>     <td id="compPVta12">0,00 / 0,00</td><td id="compPVta10">0,00 / 0,00</td><td id="compPVta6">0,00 / 0,00</td></tr>
                            <tr><td>IVA</td>              <td id="compIva12">0,00 / 0,00</td><td id="compIva10">0,00 / 0,00</td><td id="compIva6">0,00 / 0,00</td></tr>
                            <tr><td>Precio Final</td>     <td id="compFinal12">0,00 / 0,00</td><td id="compFinal10">0,00 / 0,00</td><td id="compFinal6">0,00 / 0,00</td></tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                    <!-- Card de costos unitarios con diseÃ±o mejorado -->
                    <div class="card border-0 shadow-sm">
                      <div class="card-body">
                        <h6>Costo y precio unitario (por <span id="unitarioUnidadLabel">unidad</span>)</h6>
                        <div class="row g-1 mb-2">
                          <div class="col-7 col-sm-6">Costo unitario:</div>
                          <div class="col-5 col-sm-6 text-end text-sm-start fw-bold" id="costoUnitario">0,00 Bs. Â· 0,00 $</div>
                        </div>
                        <div class="row g-1 mb-2">
                          <div class="col-7 col-sm-6">Precio venta unitario:</div>
                          <div class="col-5 col-sm-6 text-end text-sm-start fw-bold" id="precioVentaUnitario">0,00 Bs. Â· 0,00 $</div>
                        </div>
                        <div class="row g-1">
                          <div class="col-7 col-sm-6">Precio final unitario (con IVA):</div>
                          <div class="col-5 col-sm-6 text-end text-sm-start fw-bold" id="precioFinalUnitario">0,00 Bs. Â· 0,00 $</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div><!-- /modal-body -->

        <div class="modal-footer bg-light">
          <button type="button" class="btn btn-secondary" id="prevBtn" disabled>
            <i class="bi bi-chevron-left"></i> Anterior
          </button>
          <button type="button" class="btn btn-primary" id="nextBtn">
            Siguiente <i class="bi bi-chevron-right"></i>
          </button>
          <button type="button" class="btn btn-success" id="generateBtn" style="display:none;">
            <i class="bi bi-file-earmark-check"></i> Generar presupuesto
          </button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>

      </div>
    </div>
  </div>

</main>

<!-- JS de terceros (locales) â€” orden importa -->
<script src="assets/libs/jquery-3.6.4/jquery-3.6.4.min.js"></script>
<script src="assets/libs/bootstrap/bootstrap.bundle.min.js"></script>
<script src="assets/libs/dataTable/jquery.dataTables.min.js"></script>
<script src="assets/libs/dataTable/dataTables.bootstrap5.min.js"></script>
<script src="assets/libs/dataTable/dataTables.responsive.min.js"></script>
<script src="assets/libs/dataTable/responsive.bootstrap5.min.js"></script>
<script src="assets/libs/select2/select2.min.js"></script>
<script src="assets/libs/introjs/intro.min.js"></script>

<!-- JS propio (debe contener la lÃ³gica que ya tienes) -->
<script src="assets/js/app.js"></script>

</body>
</html>